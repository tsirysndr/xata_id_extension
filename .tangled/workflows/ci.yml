when:
  - event: ["push", "pull_request"]
    branch: ["main"]

dependencies:
  nixpkgs:
    - cargo
    - cargo-pgrx
    - rustc
    - rustfmt
    - gnused
    - gnugrep
    - flex

steps:
  - name: "cargo fmt"
    command: |
       cargo fmt --all --check
  - name: "cargo test"
    command: |
       cargo pgrx init
       cargo pgrx test
